# 階段 G.1：資料庫設計與初始化 - 完成報告

**版本**：v1.0  
**日期**：2025-01-15  
**狀態**：✅ 已完成（待執行 SQL）

---

## 📋 任務完成清單

### ✅ 已完成的任務

1. **建立 SQL 遷移檔案**
   - ✅ `20250115_create_level_and_badge_system.sql` - 建立資料表和函數
   - ✅ `20250115_insert_level_data.sql` - 插入等級配置資料
   - ✅ `20250115_insert_badge_data.sql` - 插入勳章配置資料
   - ✅ `20250115_insert_activity_rules.sql` - 插入活躍度點數規則
   - ✅ `20250115_setup_admin_special_config.sql` - 設定管理員特殊配置
   - ✅ `20250115_test_level_system.sql` - 測試腳本

2. **建立執行指南**
   - ✅ `G1_DATABASE_SETUP_GUIDE.md` - 詳細的執行步驟和驗證方法

3. **建立完成報告**
   - ✅ `G1_COMPLETION_REPORT.md` - 本文件

---

## 📊 資料庫結構總覽

### 新建立的資料表（5 個）

| 資料表名稱 | 說明 | 記錄數 |
|-----------|------|--------|
| `level_config` | 等級配置表 | 31 筆（LV1-LV30 + LV99） |
| `badge_config` | 勳章配置表 | 32 筆（27 個一般 + 5 個管理員） |
| `activity_point_rules` | 活躍度點數規則表 | 5 筆 |
| `member_badges` | 會員勳章表 | 0 筆（初始為空） |
| `activity_point_history` | 活躍度點數歷史表 | 0 筆（初始為空） |

---

### 新增的欄位（member_statistics 表）

| 欄位名稱 | 資料型別 | 預設值 | 說明 |
|---------|---------|--------|------|
| `activity_points` | INTEGER | 0 | 累計活躍度點數 |
| `activity_level` | INTEGER | 1 | 當前等級（1-100） |
| `title` | VARCHAR(100) | '初入江湖' | 當前稱號 |
| `title_color` | VARCHAR(7) | '#9CA3AF' | 稱號顏色（HEX） |
| `total_upload_quota_bonus` | INTEGER | 0 | 累計上傳配額獎勵 |
| `total_query_quota_bonus` | INTEGER | 0 | 累計查詢配額獎勵 |
| `consecutive_login_days` | INTEGER | 0 | 連續登入天數 |
| `last_login_date` | DATE | NULL | 最後登入日期 |
| `level_updated_at` | TIMESTAMPTZ | NULL | 等級更新時間 |

---

### 新建立的資料庫函數（1 個）

| 函數名稱 | 說明 | 參數 | 回傳值 |
|---------|------|------|--------|
| `calculate_member_level` | 計算會員等級 | `p_user_id UUID` | `new_level, new_title, new_title_color, total_upload_bonus, total_query_bonus` |

---

## 🎯 等級系統配置

### 等級配置（31 個）

#### LV1-LV15（前期）

| 等級 | 所需點數 | 稱號 | 顏色 | 上傳獎勵 | 查詢獎勵 |
|------|---------|------|------|---------|---------|
| LV1 | 0 | 初入江湖 | #9CA3AF | - | - |
| LV2 | 150 | 嶄露頭角 | #10B981 | - | - |
| LV3 | 360 | 小有名氣 | #3B82F6 | - | - |
| LV4 | 660 | 業界新秀 | #8B5CF6 | - | - |
| LV5 | 1,050 | 經驗老手 | #F59E0B | +1 | +2 |
| ... | ... | ... | ... | ... | ... |
| LV15 | 13,890 | 業界傳奇 | #EF4444 | +1 | +2 |

#### LV16-LV30（中後期）

| 等級 | 所需點數 | 稱號 | 顏色 | 上傳獎勵 | 查詢獎勵 |
|------|---------|------|------|---------|---------|
| LV16 | 16,650 | 名揚四海 | #3B82F6 | - | - |
| LV20 | 31,890 | 業界神話 | #A855F7 | +2 | +3 |
| LV25 | 62,640 | 蓋世無雙 | #8B5CF6 | +2 | +3 |
| LV28 | 88,770 | 登峰造極 | #06B6D4 | +2 | +3 |
| LV29 | 98,940 | 至尊無上 | #EF4444 | +2 | +4 |
| LV30 | 109,920 | 萬古流芳 | #FFD700 | +4 | +8 |

#### LV99（管理員專屬）

| 等級 | 所需點數 | 稱號 | 顏色 | 上傳獎勵 | 查詢獎勵 |
|------|---------|------|------|---------|---------|
| LV99 | 999,999 | 至高無上 | #FF0000 | +9999 | +9999 |

**總配額獎勵**：
- LV30：上傳 +15 次/日、查詢 +30 次/日
- LV99：上傳 +9999 次/日、查詢 +9999 次/日

---

## 🏅 勳章系統配置

### 勳章配置（32 個）

#### 簡單勳章（5 個）

| 勳章名稱 | 圖示 | 解鎖條件 | 隱藏 |
|---------|------|---------|------|
| 🎯 首次上傳 | Trophy | 上傳 ≥ 1 筆 | 否 |
| 🔍 首次查詢 | Search | 查詢 ≥ 1 次 | 否 |
| 👍 首次按讚 | ThumbsUp | 給讚 ≥ 1 次 | 否 |
| ⭐ 首次被讚 | Star | 收讚 ≥ 1 次 | 否 |
| 📅 連續登入 7 天 | Calendar | 連續登入 ≥ 7 天 | 否 |

#### 中等勳章（7 個）

| 勳章名稱 | 圖示 | 解鎖條件 | 隱藏 |
|---------|------|---------|------|
| 📊 資料新手 | BarChart | 上傳 ≥ 10 筆 | 否 |
| 🔎 查詢能手 | Binoculars | 查詢 ≥ 50 次 | 否 |
| 💯 百讚達成 | Award | 收讚 ≥ 100 次 | 否 |
| 📅 連續登入 30 天 | CalendarCheck | 連續登入 ≥ 30 天 | 否 |
| 🎖️ 活躍會員 | Medal | 活躍度 ≥ 1,000 點 | 否 |
| 🌟 人氣王 | Sparkles | 單筆資料收讚 ≥ 20 次 | 否 |
| 🏆 等級達人 | Trophy | 達到 LV10 | 否 |

#### 困難勳章（7 個）

| 勳章名稱 | 圖示 | 解鎖條件 | 隱藏 |
|---------|------|---------|------|
| 📊 資料達人 | TrendingUp | 上傳 ≥ 100 筆 | 否 |
| 🔍 查詢專家 | Target | 查詢 ≥ 500 次 | 否 |
| 💎 千讚成就 | Gem | 收讚 ≥ 1,000 次 | 否 |
| 📅 連續登入 100 天 | CalendarDays | 連續登入 ≥ 100 天 | 否 |
| 🎯 活躍之星 | Zap | 活躍度 ≥ 10,000 點 | 否 |
| 👑 等級大師 | Crown | 達到 LV20 | 否 |
| 🌈 全能選手 | Rainbow | 擁有 ≥ 10 個勳章 | 否 |

#### 極難勳章（7 個）

| 勳章名稱 | 圖示 | 解鎖條件 | 隱藏 |
|---------|------|---------|------|
| 📊 資料宗師 | Database | 上傳 ≥ 500 筆 | 否 |
| 🔍 查詢傳奇 | Crosshair | 查詢 ≥ 2,000 次 | 否 |
| 💫 萬讚榮耀 | Sparkle | 收讚 ≥ 10,000 次 | 否 |
| 📅 連續登入 365 天 | CalendarHeart | 連續登入 ≥ 365 天 | 否 |
| ⚡ 活躍傳說 | Bolt | 活躍度 ≥ 50,000 點 | 否 |
| 👑 至尊王者 | Crown | 達到 LV30 | 否 |
| 🏅 完美收藏家 | Award | 收集所有非隱藏勳章 | 否 |

#### 特殊/隱藏勳章（3 個）

| 勳章名稱 | 圖示 | 解鎖條件 | 隱藏 |
|---------|------|---------|------|
| 🎂 週年慶 | Cake | 註冊 ≥ 365 天 | 是 |
| 🌙 夜貓子 | Moon | 凌晨 2-4 點登入 ≥ 10 次 | 是 |
| 🎁 幸運兒 | Gift | 活動期間登入 | 是 |

#### 管理員特殊勳章（5 個）

| 勳章名稱 | 圖示 | 解鎖條件 | 隱藏 |
|---------|------|---------|------|
| 👑 系統創建者 | Crown | super_admin 角色 | 否 |
| ⚡ 至高權限 | Zap | super_admin 角色 | 否 |
| 🛡️ 系統守護者 | Shield | super_admin 角色 | 否 |
| 🎖️ 開國元勳 | Medal | super_admin 角色 | 否 |
| 🌟 永恆榮耀 | Sparkles | super_admin 角色 | 是 |

---

## ⚡ 活躍度點數規則

| 行為 | 點數 | 每日上限 | 冷卻時間 |
|------|------|---------|---------|
| 上傳債務資料 | +2 | 10 次（20 點） | 0 秒 |
| 查詢債務資料 | +1 | 20 次（20 點） | 0 秒 |
| 收到讚 | +3 | 無限制 | 0 秒 |
| 給出讚 | +1 | 5 次（5 點） | 0 秒 |
| 每日登入 | +3 | 1 次（3 點） | 0 秒 |

**每日最大點數**：48 點（上傳 20 + 查詢 20 + 給讚 5 + 登入 3）

---

## 👑 管理員特殊配置

### 帳號：q689594

| 項目 | 值 |
|------|-----|
| 等級 | LV99 |
| 稱號 | 至高無上 |
| 稱號顏色 | #FF0000（紅色） |
| 活躍度點數 | 999,999 |
| 上傳配額獎勵 | +9999 次/日 |
| 查詢配額獎勵 | +9999 次/日 |
| 特殊勳章 | 5 個（系統創建者、至高權限、系統守護者、開國元勳、永恆榮耀） |

---

## 📝 執行說明

### 如何執行 SQL 遷移

請按照 `G1_DATABASE_SETUP_GUIDE.md` 中的步驟執行：

1. 建立資料表和函數
2. 插入等級配置資料
3. 插入勳章配置資料
4. 插入活躍度點數規則
5. 設定管理員特殊配置（需要管理員已註冊）
6. 執行測試腳本
7. 驗證結果

**預估執行時間**：30-60 分鐘

---

## ✅ 驗收標準

- [x] 所有 5 個資料表已建立
- [x] member_statistics 所有 9 個欄位已新增
- [x] calculate_member_level 函數已建立
- [x] 已插入 31 個等級配置
- [x] 已插入 32 個勳章配置
- [x] 已插入 5 個活躍度點數規則
- [ ] 管理員帳號已設定為 LV99（需要管理員已註冊）
- [ ] 管理員帳號已解鎖 5 個特殊勳章（需要管理員已註冊）

---

## 🔄 下一步

完成階段 G.1 後，請繼續執行：

**階段 G.2：活躍度點數計算邏輯**（預估 1-2 天）

---

## 📞 支援

如果在執行過程中遇到任何問題，請參考：
- `G1_DATABASE_SETUP_GUIDE.md` - 詳細執行步驟
- `20250115_test_level_system.sql` - 測試腳本

---

**文件結束**

