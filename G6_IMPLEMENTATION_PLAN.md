# 階段 G.6：管理員配置介面 - 實作計畫

**版本**：v1.0  
**日期**：2025-10-14  
**預估時間**：1-2 天（8-16 小時）

---

## 📋 任務概覽

### 主要目標
建立管理員專用的配置介面，讓管理員可以調整等級系統、勳章系統和活躍度規則的各項參數。

### 已完成的工作（階段 G.1-G.5）
- ✅ 資料庫設計和初始化
- ✅ 活躍度點數計算邏輯
- ✅ 等級升級觸發（前端整合）
- ✅ 勳章解鎖邏輯（前端整合）
- ✅ 會員等級顯示整合

### 待完成的工作（階段 G.6）
- ⏳ 建立管理員配置頁面
- ⏳ 建立管理員專用 API
- ⏳ 實作配置修改功能
- ⏳ 實作配置驗證功能

---

## 🎯 詳細任務

### 任務 1：建立等級配置頁面（3 小時）

#### 1.1 建立等級配置頁面
- **檔案**：`src/app/admin/level-config/page.tsx`
- **功能**：
  - 顯示所有等級配置（LV1-LV30 + LV99）
  - 支援編輯等級資訊（稱號、顏色、所需點數、獎勵）
  - 支援新增等級
  - 支援刪除等級（保護 LV1 和 LV99）
  - 即時預覽等級徽章
  - 驗證輸入（點數遞增、顏色格式等）

#### 1.2 設計規格
- **表格顯示**：
  ```
  等級 | 稱號 | 顏色 | 所需點數 | 上傳獎勵 | 查詢獎勵 | 操作
  LV1  | 初入江湖 | #9CA3AF | 0 | 0 | 0 | [編輯]
  LV2  | 嶄露頭角 | #10B981 | 100 | 0 | 0 | [編輯] [刪除]
  ...
  ```

- **編輯表單**：
  - 等級數字（不可編輯）
  - 稱號（文字輸入）
  - 顏色（顏色選擇器）
  - 所需點數（數字輸入）
  - 上傳配額獎勵（數字輸入）
  - 查詢配額獎勵（數字輸入）

---

### 任務 2：建立勳章配置頁面（3 小時）

#### 2.1 建立勳章配置頁面
- **檔案**：`src/app/admin/badge-config/page.tsx`
- **功能**：
  - 顯示所有勳章配置（34 個勳章）
  - 支援編輯勳章資訊（名稱、描述、難度、圖示、條件）
  - 支援新增勳章
  - 支援刪除勳章
  - 即時預覽勳章圖示
  - 驗證輸入（條件格式等）

#### 2.2 設計規格
- **網格顯示**：
  ```
  ┌─────────────────────────────┐
  │ 🏅 首次上傳                 │
  │ 完成第一次債務資料上傳      │
  │ 難度：簡單                  │
  │ 條件：上傳次數 >= 1         │
  │ [編輯] [刪除]               │
  └─────────────────────────────┘
  ```

- **編輯表單**：
  - 勳章 Key（不可編輯）
  - 勳章名稱（文字輸入）
  - 描述（文字區域）
  - 難度（下拉選單：easy, medium, hard, extreme, special）
  - 圖示名稱（下拉選單：lucide-react 圖示）
  - 解鎖條件（JSON 編輯器）

---

### 任務 3：建立活躍度規則配置頁面（2 小時）

#### 3.1 建立活躍度規則配置頁面
- **檔案**：`src/app/admin/activity-rules/page.tsx`
- **功能**：
  - 顯示所有活躍度規則（5 個動作）
  - 支援編輯規則（點數、每日上限、冷卻時間）
  - 驗證輸入（點數 > 0、上限 >= 0 等）

#### 3.2 設計規格
- **表格顯示**：
  ```
  動作 | 點數 | 每日上限 | 冷卻時間 | 操作
  上傳 | +2 | 10 | 0 秒 | [編輯]
  查詢 | +1 | 20 | 60 秒 | [編輯]
  每日登入 | +3 | 1 | 0 秒 | [編輯]
  給讚 | +1 | 5 | 0 秒 | [編輯]
  收讚 | +3 | 無限制 | 0 秒 | [編輯]
  ```

- **編輯表單**：
  - 動作名稱（不可編輯）
  - 點數（數字輸入）
  - 每日上限（數字輸入，-1 表示無限制）
  - 冷卻時間（數字輸入，秒）

---

### 任務 4：建立管理員專用 API（3 小時）

#### 4.1 等級配置 API
- **檔案**：`src/app/api/admin/level-config/route.ts`
- **端點**：
  - `GET /api/admin/level-config` - 取得所有等級配置
  - `PUT /api/admin/level-config` - 更新等級配置
  - `POST /api/admin/level-config` - 新增等級配置
  - `DELETE /api/admin/level-config` - 刪除等級配置

#### 4.2 勳章配置 API
- **檔案**：`src/app/api/admin/badge-config/route.ts`
- **端點**：
  - `GET /api/admin/badge-config` - 取得所有勳章配置
  - `PUT /api/admin/badge-config` - 更新勳章配置
  - `POST /api/admin/badge-config` - 新增勳章配置
  - `DELETE /api/admin/badge-config` - 刪除勳章配置

#### 4.3 活躍度規則 API
- **檔案**：`src/app/api/admin/activity-rules/route.ts`
- **端點**：
  - `GET /api/admin/activity-rules` - 取得所有活躍度規則
  - `PUT /api/admin/activity-rules` - 更新活躍度規則

#### 4.4 權限驗證
- 所有 API 都需要驗證使用者是否為管理員（super_admin 或 admin）
- 使用 middleware 或在每個 API 中檢查

---

### 任務 5：建立共用組件（2 小時）

#### 5.1 ColorPicker 組件
- **檔案**：`src/components/admin/ColorPicker.tsx`
- **功能**：顏色選擇器

#### 5.2 IconPicker 組件
- **檔案**：`src/components/admin/IconPicker.tsx`
- **功能**：圖示選擇器（lucide-react）

#### 5.3 ConfirmDialog 組件
- **檔案**：`src/components/admin/ConfirmDialog.tsx`
- **功能**：確認對話框

---

### 任務 6：更新管理員導航（1 小時）

#### 6.1 更新 AdminNav
- **檔案**：`src/components/admin/AdminNav.tsx`
- **新增選單項目**：
  - 等級配置
  - 勳章配置
  - 活躍度規則

---

### 任務 7：測試與優化（2 小時）

#### 7.1 功能測試
- ✅ 等級配置 CRUD 正常
- ✅ 勳章配置 CRUD 正常
- ✅ 活躍度規則更新正常
- ✅ 權限驗證正常
- ✅ 輸入驗證正常

#### 7.2 視覺測試
- ✅ 在不同螢幕尺寸下顯示正常
- ✅ 響應式設計正常

#### 7.3 安全測試
- ✅ 非管理員無法訪問
- ✅ 無法刪除 LV1 和 LV99
- ✅ 輸入驗證防止錯誤資料

---

## 📁 檔案結構

```
src/
├── components/
│   └── admin/
│       ├── ColorPicker.tsx             # 顏色選擇器
│       ├── IconPicker.tsx              # 圖示選擇器
│       ├── ConfirmDialog.tsx           # 確認對話框
│       └── AdminNav.tsx                # 管理員導航（更新）
├── app/
│   ├── admin/
│   │   ├── level-config/
│   │   │   └── page.tsx                # 等級配置頁面
│   │   ├── badge-config/
│   │   │   └── page.tsx                # 勳章配置頁面
│   │   └── activity-rules/
│   │       └── page.tsx                # 活躍度規則頁面
│   └── api/
│       └── admin/
│           ├── level-config/
│           │   └── route.ts            # 等級配置 API
│           ├── badge-config/
│           │   └── route.ts            # 勳章配置 API
│           └── activity-rules/
│               └── route.ts            # 活躍度規則 API
└── types/
    └── admin.ts                        # 管理員類型定義（新增）
```

---

## 🔄 實作順序

### 第 1 步：建立類型定義和共用組件（2 小時）
1. 建立管理員類型定義
2. 建立 ColorPicker 組件
3. 建立 IconPicker 組件
4. 建立 ConfirmDialog 組件

### 第 2 步：建立管理員 API（3 小時）
1. 建立等級配置 API
2. 建立勳章配置 API
3. 建立活躍度規則 API
4. 實作權限驗證

### 第 3 步：建立配置頁面（6 小時）
1. 建立等級配置頁面
2. 建立勳章配置頁面
3. 建立活躍度規則頁面

### 第 4 步：更新導航（1 小時）
1. 更新 AdminNav

### 第 5 步：測試與優化（2 小時）
1. 功能測試
2. 視覺測試
3. 安全測試
4. Bug 修正

---

## ⏱️ 時間分配

| 任務 | 預估時間 | 優先級 |
|------|---------|--------|
| 建立類型定義和共用組件 | 2 小時 | 高 |
| 建立管理員 API | 3 小時 | 高 |
| 建立等級配置頁面 | 3 小時 | 高 |
| 建立勳章配置頁面 | 3 小時 | 中 |
| 建立活躍度規則頁面 | 2 小時 | 中 |
| 更新管理員導航 | 1 小時 | 低 |
| 測試與優化 | 2 小時 | 高 |
| **總計** | **16 小時** | - |

---

## 🚀 準備開始

**確認清單**：
- ✅ 階段 G.5 已完成
- ✅ 會員等級顯示正常
- ✅ 資料庫結構完整
- ✅ 設計規格確認

**下一步**：開始實作！

---

**文件結束**

