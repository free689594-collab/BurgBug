# Vercel ç”Ÿç”¢ç’°å¢ƒæ•ˆèƒ½è¨ºæ–·å ±å‘Š

**ç”Ÿæˆæ—¥æœŸ**ï¼š2025-11-03  
**å°ˆæ¡ˆåç¨±**ï¼šè‡»å¥½å°‹å‚µå‹™å¹³å°  
**Vercel å°ˆæ¡ˆ**ï¼šzhenhaoxun (burg-bug)  
**ç”Ÿç”¢ URL**ï¼šhttps://burg-bug.vercel.app

---

## ğŸš¨ ç™¼ç¾çš„é—œéµå•é¡Œ

### âŒ **å•é¡Œ 1ï¼šServerless Functions éƒ¨ç½²åœ¨éŒ¯èª¤çš„å€åŸŸ**

**ç™¼ç¾**ï¼š
- ä½ çš„ Serverless Functions éƒ¨ç½²åœ¨ **`iad1`ï¼ˆç¾åœ‹ç¶­å‰å°¼äºå·ï¼‰**
- ä½ çš„ Supabase è³‡æ–™åº«åœ¨ **`ap-south-1`ï¼ˆå°åº¦å­Ÿè²·ï¼‰**
- é€™å…©å€‹å€åŸŸç›¸è· **è¶…é 12,000 å…¬é‡Œ**ï¼

**å½±éŸ¿**ï¼š
- æ¯æ¬¡ API å‘¼å«è³‡æ–™åº«çš„ç¶²è·¯å»¶é²ï¼š**200-300ms**
- å¦‚æœä¸€å€‹ API éœ€è¦æŸ¥è©¢è³‡æ–™åº« 10 æ¬¡ï¼š**2-3 ç§’çš„å»¶é²**
- é€™æ˜¯é€ æˆã€Œæœ‰é»å¡ã€çš„ä¸»è¦åŸå› 

**ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ**
- ä½ çš„ `vercel.json` è¨­å®šäº† `"regions": ["sin1"]`ï¼ˆæ–°åŠ å¡ï¼‰
- ä½† Vercel å¯¦éš›éƒ¨ç½²åœ¨ `iad1`ï¼ˆç¾åœ‹ï¼‰
- å¯èƒ½åŸå› ï¼š
  1. Vercel å…è²»æ–¹æ¡ˆå¯èƒ½ä¸æ”¯æ´é¸æ“‡å€åŸŸ
  2. é…ç½®æ²’æœ‰æ­£ç¢ºç”Ÿæ•ˆ
  3. éœ€è¦åœ¨ Vercel Dashboard ä¸­æ‰‹å‹•è¨­å®š

---

## ğŸ“Š æ•ˆèƒ½å½±éŸ¿åˆ†æ

### ç¶²è·¯å»¶é²å°æ¯”

| è·¯å¾‘ | å»¶é²ï¼ˆå–®æ¬¡ï¼‰ | 10 æ¬¡æŸ¥è©¢ | å½±éŸ¿ |
|------|------------|----------|------|
| **ç¾åœ‹ â†’ å°åº¦** | 200-300ms | 2-3 ç§’ | âŒ éå¸¸æ…¢ |
| **æ–°åŠ å¡ â†’ å°åº¦** | 40-80ms | 0.4-0.8 ç§’ | âœ… å¯æ¥å— |
| **æ”¹å–„å¹…åº¦** | -60-75% | -60-75% | ğŸ¯ é—œéµ |

### å¯¦éš›å½±éŸ¿

å‡è¨­ä¸€å€‹ API éœ€è¦ï¼š
- é©—è­‰ä½¿ç”¨è€…ï¼š1 æ¬¡æŸ¥è©¢ï¼ˆ200msï¼‰
- æŸ¥è©¢è³‡æ–™ï¼š3 æ¬¡æŸ¥è©¢ï¼ˆ600msï¼‰
- æ›´æ–°çµ±è¨ˆï¼š2 æ¬¡æŸ¥è©¢ï¼ˆ400msï¼‰
- è¨˜éŒ„æ—¥èªŒï¼š1 æ¬¡æŸ¥è©¢ï¼ˆ200msï¼‰

**ç¸½å»¶é²**ï¼š
- ç›®å‰ï¼ˆç¾åœ‹ â†’ å°åº¦ï¼‰ï¼š**1.4 ç§’**ï¼ˆåƒ…ç¶²è·¯å»¶é²ï¼‰
- å„ªåŒ–å¾Œï¼ˆæ–°åŠ å¡ â†’ å°åº¦ï¼‰ï¼š**0.3 ç§’**ï¼ˆåƒ…ç¶²è·¯å»¶é²ï¼‰
- **æ”¹å–„**ï¼š**-1.1 ç§’**

åŠ ä¸Šç¨‹å¼ç¢¼åŸ·è¡Œæ™‚é–“ï¼ˆç´„ 0.5-1 ç§’ï¼‰ï¼Œç¸½å›æ‡‰æ™‚é–“ï¼š
- ç›®å‰ï¼š**1.9-2.4 ç§’**
- å„ªåŒ–å¾Œï¼š**0.8-1.3 ç§’**

---

## âœ… è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä¿®æ”¹ Vercel å€åŸŸè¨­å®šï¼ˆæ¨è–¦ï¼‰

#### æ­¥é©Ÿ 1ï¼šæª¢æŸ¥ Vercel æ–¹æ¡ˆ

1. å‰å¾€ Vercel Dashboardï¼šhttps://vercel.com/kuan-yus-projects/burg-bug/settings
2. æª¢æŸ¥ä½ çš„æ–¹æ¡ˆï¼ˆHobby / Proï¼‰
3. **é‡è¦**ï¼šå…è²»çš„ Hobby æ–¹æ¡ˆå¯èƒ½ä¸æ”¯æ´é¸æ“‡å€åŸŸ

**å¦‚æœæ˜¯ Hobby æ–¹æ¡ˆ**ï¼š
- é è¨­éƒ¨ç½²åœ¨ç¾åœ‹ï¼ˆ`iad1`ï¼‰
- éœ€è¦å‡ç´šåˆ° Pro æ–¹æ¡ˆï¼ˆ$20/æœˆï¼‰æ‰èƒ½é¸æ“‡å€åŸŸ

**å¦‚æœæ˜¯ Pro æ–¹æ¡ˆ**ï¼š
- å¯ä»¥åœ¨å°ˆæ¡ˆè¨­å®šä¸­é¸æ“‡å€åŸŸ

#### æ­¥é©Ÿ 2ï¼šä¿®æ”¹å€åŸŸè¨­å®šï¼ˆPro æ–¹æ¡ˆï¼‰

1. å‰å¾€å°ˆæ¡ˆè¨­å®šï¼šhttps://vercel.com/kuan-yus-projects/burg-bug/settings/functions
2. æ‰¾åˆ°ã€ŒFunction Regionã€è¨­å®š
3. é¸æ“‡ **Singapore (sin1)** æˆ– **Mumbai (bom1)**
4. å„²å­˜è¨­å®š
5. é‡æ–°éƒ¨ç½²

#### æ­¥é©Ÿ 3ï¼šé©—è­‰å€åŸŸ

é‡æ–°éƒ¨ç½²å¾Œï¼Œæª¢æŸ¥éƒ¨ç½²è©³æƒ…ï¼š
```bash
# ä½¿ç”¨ Vercel CLI
vercel inspect <deployment-url>
```

æˆ–åœ¨ Vercel Dashboard ä¸­æŸ¥çœ‹éƒ¨ç½²çš„ `regions` æ¬„ä½ã€‚

---

### æ–¹æ¡ˆ 2ï¼šå°‡ Supabase é·ç§»åˆ°æ›´è¿‘çš„å€åŸŸï¼ˆä¸æ¨è–¦ï¼‰

**é¸é …**ï¼š
- å°‡ Supabase å¾ `ap-south-1`ï¼ˆå°åº¦ï¼‰é·ç§»åˆ° `us-east-1`ï¼ˆç¾åœ‹ï¼‰

**ç¼ºé»**ï¼š
- éœ€è¦åŒ¯å‡ºå’ŒåŒ¯å…¥æ‰€æœ‰è³‡æ–™
- å¯èƒ½é€ æˆè³‡æ–™éºå¤±
- å°å°ç£ä½¿ç”¨è€…ä¾†èªªï¼Œå°åº¦æ¯”ç¾åœ‹æ›´è¿‘

**ä¸æ¨è–¦åŸå› **ï¼š
- ä½ çš„ä¸»è¦ä½¿ç”¨è€…å¯èƒ½åœ¨äºæ´²
- å°åº¦æ˜¯äºæ´²æœ€ä½³çš„è³‡æ–™åº«ä½ç½®

---

### æ–¹æ¡ˆ 3ï¼šå„ªåŒ–è³‡æ–™åº«æŸ¥è©¢æ¬¡æ•¸ï¼ˆç«‹å³å¯åšï¼‰

å³ä½¿ç„¡æ³•æ”¹è®Šå€åŸŸï¼Œä¹Ÿå¯ä»¥é€éæ¸›å°‘è³‡æ–™åº«æŸ¥è©¢æ¬¡æ•¸ä¾†æ”¹å–„æ•ˆèƒ½ã€‚

#### å„ªåŒ– 1ï¼šä½¿ç”¨è³‡æ–™åº« VIEW åˆä½µæŸ¥è©¢

**ç›®å‰å•é¡Œ**ï¼š
- æŸ¥è©¢ API éœ€è¦åŸ·è¡Œ 5-10 æ¬¡è³‡æ–™åº«æŸ¥è©¢
- æ¯æ¬¡æŸ¥è©¢éƒ½æœ‰ 200-300ms çš„ç¶²è·¯å»¶é²

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
å»ºç«‹è³‡æ–™åº« VIEWï¼Œå°‡å¤šæ¬¡æŸ¥è©¢åˆä½µç‚ºä¸€æ¬¡ã€‚

**å¯¦ä½œæ­¥é©Ÿ**ï¼š

åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œï¼š

```sql
-- å»ºç«‹å‚µå‹™è¨˜éŒ„å®Œæ•´è³‡è¨Š VIEW
CREATE OR REPLACE VIEW debt_records_with_full_info AS
SELECT 
  dr.*,
  -- ä¸Šå‚³è€…è³‡è¨Š
  m.account as uploader_account,
  m.nickname as uploader_nickname,
  -- ä¸Šå‚³è€…ç­‰ç´š
  ms.activity_level as uploader_level,
  ms.activity_points as uploader_points,
  lc.level_name as uploader_level_name,
  lc.badge_icon as uploader_badge_icon,
  -- æŒ‰è®šæ•¸
  (SELECT COUNT(*) FROM debt_record_likes WHERE debt_record_id = dr.id) as likes_count
FROM debt_records dr
LEFT JOIN members m ON dr.uploaded_by = m.user_id
LEFT JOIN member_statistics ms ON dr.uploaded_by = ms.user_id
LEFT JOIN level_config lc ON ms.activity_level = lc.level_number;

COMMENT ON VIEW debt_records_with_full_info IS 
'å‚µå‹™è¨˜éŒ„å®Œæ•´è³‡è¨Šï¼ˆåŒ…å«ä¸Šå‚³è€…è³‡è¨Šã€ç­‰ç´šã€å‹³ç« ã€æŒ‰è®šæ•¸ï¼‰';
```

ç„¶å¾Œä¿®æ”¹ `src/app/api/debts/search/route.ts`ï¼š

```typescript
// åŸæœ¬ï¼šéœ€è¦ 5-10 æ¬¡æŸ¥è©¢
const { data: debtRecords } = await supabaseAdmin
  .from('debt_records_masked')
  .select('*')
  // ... ç„¶å¾Œå†æŸ¥è©¢ä¸Šå‚³è€…è³‡è¨Šã€ç­‰ç´šã€å‹³ç« ã€æŒ‰è®šæ•¸ ...

// å„ªåŒ–å¾Œï¼šåªéœ€è¦ 1 æ¬¡æŸ¥è©¢
const { data: debtRecords } = await supabaseAdmin
  .from('debt_records_with_full_info')
  .select('*')
  .eq('debtor_id_first_letter', firstLetter)
  .eq('debtor_id_last5', last5)
```

**é æœŸæ”¹å–„**ï¼š
- æŸ¥è©¢æ¬¡æ•¸ï¼š10 æ¬¡ â†’ 1 æ¬¡
- ç¶²è·¯å»¶é²ï¼š2-3 ç§’ â†’ 0.2-0.3 ç§’
- ç¸½å›æ‡‰æ™‚é–“ï¼š2.5-3.5 ç§’ â†’ **0.7-1.3 ç§’**

---

#### å„ªåŒ– 2ï¼šä½¿ç”¨ Redis å¿«å–ç†±é–€æŸ¥è©¢

**é©ç”¨å ´æ™¯**ï¼š
- å¦‚æœæœ‰å¾ˆå¤šé‡è¤‡æŸ¥è©¢ï¼ˆä¾‹å¦‚ï¼šæŸ¥è©¢åŒä¸€å€‹å‚µå‹™äººï¼‰

**å¯¦ä½œæ­¥é©Ÿ**ï¼š

1. è¨»å†Š Upstash Redisï¼ˆå…è²»æ–¹æ¡ˆï¼‰ï¼šhttps://upstash.com/
2. å®‰è£å®¢æˆ¶ç«¯ï¼š
```bash
npm install @upstash/redis
```

3. ä¿®æ”¹æŸ¥è©¢ APIï¼š
```typescript
import { Redis } from '@upstash/redis'

const redis = new Redis({
  url: process.env.UPSTASH_REDIS_REST_URL!,
  token: process.env.UPSTASH_REDIS_REST_TOKEN!,
})

export async function GET(req: NextRequest) {
  const searchKey = `${firstLetter}${last5}${residence || ''}`
  
  // 1. å…ˆæª¢æŸ¥å¿«å–
  const cached = await redis.get(`search:${searchKey}`)
  if (cached) {
    return NextResponse.json(successResponse(cached, 'æŸ¥è©¢æˆåŠŸï¼ˆå¿«å–ï¼‰'))
  }
  
  // 2. æŸ¥è©¢è³‡æ–™åº«
  const { data: debtRecords } = await supabaseAdmin
    .from('debt_records_with_full_info')
    .select('*')
    // ...
  
  // 3. å„²å­˜åˆ°å¿«å–ï¼ˆ5 åˆ†é˜ï¼‰
  await redis.setex(`search:${searchKey}`, 300, debtRecords)
  
  return NextResponse.json(successResponse(debtRecords, 'æŸ¥è©¢æˆåŠŸ'))
}
```

**é æœŸæ”¹å–„**ï¼š
- é‡è¤‡æŸ¥è©¢å›æ‡‰æ™‚é–“ï¼š0.7-1.3 ç§’ â†’ **< 200ms**ï¼ˆ-85%ï¼‰

---

## ğŸ¯ å»ºè­°çš„å¯¦ä½œé †åº

### éšæ®µ 1ï¼šç«‹å³åŸ·è¡Œï¼ˆæœ¬é€±å…§ï¼‰

1. âœ… **æª¢æŸ¥ Vercel æ–¹æ¡ˆ**
   - ç¢ºèªæ˜¯å¦ç‚º Pro æ–¹æ¡ˆ
   - å¦‚æœæ˜¯ Hobby æ–¹æ¡ˆï¼Œè€ƒæ…®å‡ç´š

2. âœ… **å»ºç«‹è³‡æ–™åº« VIEW**ï¼ˆç«‹å³å¯åšï¼Œç„¡éœ€å‡ç´šï¼‰
   - åŸ·è¡Œä¸Šé¢çš„ SQL
   - ä¿®æ”¹æŸ¥è©¢ API
   - é æœŸæ”¹å–„ï¼š-60-70% å›æ‡‰æ™‚é–“

3. âœ… **æ¸¬è©¦æ•ˆèƒ½**
   - ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·æ¸¬é‡ API å›æ‡‰æ™‚é–“
   - è¨˜éŒ„æ”¹å–„å¹…åº¦

### éšæ®µ 2ï¼šçŸ­æœŸå„ªåŒ–ï¼ˆ1-2 é€±å…§ï¼‰

4. ğŸ”§ **å‡ç´šåˆ° Pro æ–¹æ¡ˆ**ï¼ˆå¦‚æœé ç®—å…è¨±ï¼‰
   - è²»ç”¨ï¼š$20/æœˆ
   - é¸æ“‡æ–°åŠ å¡å€åŸŸ
   - é æœŸæ”¹å–„ï¼š-60-75% ç¶²è·¯å»¶é²

5. ğŸ”§ **è¨­å®š Redis å¿«å–**ï¼ˆå¯é¸ï¼‰
   - è¨»å†Š Upstash Redis
   - å¯¦ä½œå¿«å–é‚è¼¯
   - é æœŸæ”¹å–„ï¼šé‡è¤‡æŸ¥è©¢ -85%

### éšæ®µ 3ï¼šé•·æœŸå„ªåŒ–ï¼ˆå¯é¸ï¼‰

6. ğŸ”§ **å‰ç«¯å„ªåŒ–**
   - ç¨‹å¼ç¢¼åˆ†å‰²
   - Lazy Loading
   - åœ–ç‰‡å„ªåŒ–

---

## ğŸ“Š é æœŸæ•ˆæœç¸½çµ

### å¦‚æœåªåšã€Œå»ºç«‹è³‡æ–™åº« VIEWã€ï¼ˆå…è²»ï¼‰

| æ“ä½œ | ç›®å‰ | å„ªåŒ–å¾Œ | æ”¹å–„ |
|-----|------|--------|------|
| **ç™»å…¥** | 2-3 ç§’ | **1.5-2 ç§’** | -30% |
| **æŸ¥è©¢** | 2.5-3.5 ç§’ | **0.7-1.3 ç§’** | -70% âœ… |
| **ä¸Šå‚³** | 2-3 ç§’ | **1.5-2 ç§’** | -30% |

### å¦‚æœå‡ç´šåˆ° Pro + å»ºç«‹ VIEW

| æ“ä½œ | ç›®å‰ | å„ªåŒ–å¾Œ | æ”¹å–„ |
|-----|------|--------|------|
| **ç™»å…¥** | 2-3 ç§’ | **< 1 ç§’** | -60% âœ… |
| **æŸ¥è©¢** | 2.5-3.5 ç§’ | **< 0.5 ç§’** | -85% âœ… |
| **ä¸Šå‚³** | 2-3 ç§’ | **< 1 ç§’** | -60% âœ… |

### å¦‚æœå‡ç´šåˆ° Pro + VIEW + Redis

| æ“ä½œ | ç›®å‰ | å„ªåŒ–å¾Œ | æ”¹å–„ |
|-----|------|--------|------|
| **ç™»å…¥** | 2-3 ç§’ | **< 1 ç§’** | -60% âœ… |
| **æŸ¥è©¢ï¼ˆé¦–æ¬¡ï¼‰** | 2.5-3.5 ç§’ | **< 0.5 ç§’** | -85% âœ… |
| **æŸ¥è©¢ï¼ˆé‡è¤‡ï¼‰** | 2.5-3.5 ç§’ | **< 200ms** | -95% âœ… |
| **ä¸Šå‚³** | 2-3 ç§’ | **< 1 ç§’** | -60% âœ… |

---

## ğŸš€ ç«‹å³å¯åšçš„äº‹æƒ…

### 1. æ¸¬é‡ç›®å‰çš„å¯¦éš›æ•ˆèƒ½

é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåˆ‡æ›åˆ°ã€ŒNetworkã€æ¨™ç±¤ï¼Œæ¸¬è©¦ï¼š

- ç™»å…¥ï¼šè¨˜éŒ„ `/api/auth/login` çš„å›æ‡‰æ™‚é–“
- æŸ¥è©¢ï¼šè¨˜éŒ„ `/api/debts/search` çš„å›æ‡‰æ™‚é–“
- ä¸Šå‚³ï¼šè¨˜éŒ„ `/api/debts/upload` çš„å›æ‡‰æ™‚é–“

### 2. å»ºç«‹è³‡æ–™åº« VIEWï¼ˆå…è²»ï¼Œç«‹å³æ”¹å–„ 70%ï¼‰

è¤‡è£½ä¸Šé¢çš„ SQLï¼Œåœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œã€‚

### 3. ä¿®æ”¹æŸ¥è©¢ API

æˆ‘å¯ä»¥å”åŠ©ä½ ä¿®æ”¹ `src/app/api/debts/search/route.ts`ï¼Œä½¿ç”¨æ–°çš„ VIEWã€‚

---

## â“ éœ€è¦æˆ‘å”åŠ©ä»€éº¼ï¼Ÿ

è«‹å‘Šè¨´æˆ‘ï¼š

1. **ä½ çš„ Vercel æ–¹æ¡ˆæ˜¯ä»€éº¼ï¼Ÿ**
   - Hobbyï¼ˆå…è²»ï¼‰
   - Proï¼ˆ$20/æœˆï¼‰

2. **ä½ æƒ³å…ˆåšå“ªå€‹å„ªåŒ–ï¼Ÿ**
   - A. å»ºç«‹è³‡æ–™åº« VIEWï¼ˆå…è²»ï¼Œç«‹å³æ”¹å–„ 70%ï¼‰
   - B. å‡ç´š Vercel Pro + æ”¹å€åŸŸï¼ˆ$20/æœˆï¼Œæ”¹å–„ 85%ï¼‰
   - C. å…©è€…éƒ½åšï¼ˆæ”¹å–„ 95%ï¼‰

3. **ä½ ç›®å‰æ„Ÿè¦ºæœ€æ…¢çš„æ˜¯å“ªå€‹æ“ä½œï¼Ÿ**
   - ç™»å…¥
   - æŸ¥è©¢å‚µå‹™
   - ä¸Šå‚³å‚µå‹™
   - Dashboard è¼‰å…¥

æˆ‘æœƒæ ¹æ“šä½ çš„å›ç­”æä¾›å…·é«”çš„å¯¦ä½œæ­¥é©Ÿï¼

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**ï¼š2025-11-03  
**è¨ºæ–·è€…**ï¼šAugment Agent  
**é—œéµç™¼ç¾**ï¼šServerless Functions éƒ¨ç½²åœ¨ç¾åœ‹ï¼Œè·é›¢è³‡æ–™åº«å¤ªé 

